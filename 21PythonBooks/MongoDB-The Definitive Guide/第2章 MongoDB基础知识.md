#### 2.1 文档
文档是MongoDB的核心概念，文档就是键值对的一个有序集
相似的数据结构：映射(map)、散列(hash)或字典(dictionary),JavaScript中，文档表示为对象 {"greeting": "Hello World!"}

- 键不能含有\0(空字符串)，这个用于表示键的结尾
- .和$具有特殊意义
- 不但区分类型，也区分大小写
    -- {"foo": 3}  {"foo": "3"} 不同文档
    -- {"foo": 3}  {"Foo": 3}  不同文档
- 不能有重复的键
- 文档中键/值对是有序的
    -- {"x":1, "y":2}  {"y":2, "x":1} 不同文档
    -- 虽然Python的字典不包含顺序，但是语言的驱动具有某些特殊的机制，可以在必要时指定文档的顺序


#### 2.2 集合
集合就是一组文档
如果将MongoDB中的一个文档比喻为关系数据库中的一行，那么一个集合就相当于一张表

- 集合是动态模式的，这意味着集合里面的文档可以是多种多样的
    -- {"greeting": "Hello World!"} {"foo": 3} 可以存储于一个集合内，不光值类型不同，键也不同
    -- 为了开发方便，不能的文档类型还是放到不同的集合内吧
    -- 索引是按照集合来定义的，一个集合只放入一种类型的文档，可以更有效地对集合进行索引
    -- 尽管MongoDB没有强制要求
- 命名
- 子集合
    -- blog.posts  blog.authors 可以是组织结构更清晰
    -- GridFS 使用子集合来存储文件的元数据，这样就可以与文件内容很好地隔离开来
    -- 大多数驱动程序都提供了一个语法糖，用于访问指定集合的子集，db.blog.posts代表集合blog.posts

#### 2.3 数据库
多个文档组成集合，而多个集合可以组成数据库，每个数据库都有独立的权限
根据经验，我们将有关一个应用程序的所有数据都存储在一个数据库中

- 保留库
    -- admin
    -- local
    -- config，分片设置信息存储在该库中

#### 2.4 启动MongoDB
- 默认目录 /data/db,如果目录不存在或者不可写，服务器会启动失败
- 监听默认 27017，启动失败查看是否有另外实例在运行
- 监听 web 28017 http://localhost:28017，获取数据库的管理信息

#### 2.5 MongoDB Shell
shell是一个功能完备的JavaScript解释器，可以运行任意JavaScript程序

启动时，shell会连到MongoDB服务器的test数据库，并将数据库连接赋值给全局变量db  
如果想查看db当前指向哪个数据库，可以使用db命令

Shell 基本操作
创建 JavaScript对象

    post = {
        "title": "My Blog Post",
        "content": "Here's my blog post.",
        "date": new Date()
    }
    db.blog.insert(post)

读取

    db.blog.find()
    "_id" : ObjectId("5a794c8904a740b0a46b3558")

更新

    db.blog.update({},{},{})

删除

    db.blog.deleteOne({})
    db.blog.deleteMany({})
    db.blog.remove({})

#### 2.6 数据类型
MongoDB的文档与JavaScript中的对象类似 --> JSON(一种数据表示方式)  
JSON的表达能力有一定的局限性，如日期、浮点数和整数、正则表达式或函数

- null  
null表示空值或者不存在的字段，如db.blog.find({"x":null})就会把"x":null，或则不存在 键"x"的文档都会匹配到

- 布尔型  false  true

- 数值


    shell 默认使用64位浮点型数值
    {"x": 3.14}
    {"x": NumberInt("3")}    # 4字节带符号整数
    {"x": NumberLong("3")}   # 8字节带符号整数

- 字符串 {"x":"foobar"}
- 日期 {"x":new Date()}
- 正则表达式 {"x": /foobar/i}
- 数组，数据列表或数据集可以表示为数组  {"x": ["a", "b", "c"]}
- 内嵌文档 {"x":{"foo": "bar"}}
- 对象id  对象id是一个12字节的ID，可作为文档的唯一标识 {"x": ObjectId()}
- 其他不常用

    - 二进制
    - 代码
    {"x": function () {}}

#### 重点解读
1. 日期


    new Date()
    shell 根据本地时区设置显示日期对象，然而，数据库中存储的日期仅为新纪元以来的毫秒数，并未存储对应的时区

2. 数组


    数组就是一组值，它既能作为有序对象(如列表、栈或队列)，也可以作为无序对象(如数据集)来操作
    {"things": ["pie", 3.14]}, 可以包含不同数据类型元素，甚至可以嵌套数组

    文档中的数组有个奇妙的特性，就是MongoDB能“理解”其结构，并知道“深入”数组内部对其内容进行操作
        - MongoDB可以查询出 "things"数组中包含3.14这个元素的所有文档，经常使用的话，可以对"things"创建索引来提高性能
        - MongoDB可以使用原子更新对数组内容进行修改


3. 内嵌文档


    文档可以作为键的值，这样的文档就是内嵌文档，可以使数组组织方式更加自然，不用非得存成扁平结构的键/值对
    {
        "name": "alex",
        "address": {
            "country": "China",
            "city": "Beijing"
        }
    }
    同数组一样，MongoDB能够“理解”内嵌文档的结构，并能“深入”其中构建索引、执行查询或者更新
    这个例子可以延伸联系设计模式，内嵌文档可以改变处理数据的方式

4. _id和ObjectId
    
    
    MongoDB中存储的文档必须有一个"_id"键，这个键的值可以是任何类型，默认是个ObjectId对象

    ObjectId
    12个字节 (时间戳、机器名、PID、计数器)
    
    - 前9个字节保证了同一秒不同机器不同进程产生的ObjectId是唯一的
    - 最后3个字节是一个自动增加的计数器，确保相同的进程同一秒产生的ObjectId也是不一样的
    
    自动生成_id
    如果插入文档时没有"_id"键，系统会自动帮你创建一个，通常会在客户端由驱动程序完成
    MongoDB哲学：能交给客户端驱动程序来做的事情就不要交给服务器来做


2.7 使用MongoDB shell
    
    help
        - db.help()     # 数据库级别的帮助
        - db.foo.help() # 集合级别的帮助
        - db.foo.update # 查看代码实现
